<link rel="stylesheet" href="/third_party/bulma/bulma-divider.css">
<link rel="stylesheet" href="/third_party/bulma/bulma-tooltip.css">
<link rel="stylesheet" href="/third_party/bulma/bulma-badge.css">
<link rel="stylesheet" href="/third_party/bulma/bulma-timeline.min.css">

<script defer src="/js/chatBooking.js" data-turbolinks="false"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.min.js"
    integrity="sha512-fB746S+jyTdN2LSWbYSGP2amFYId226wpOeV4ApumcDpIttPxvk1ZPOgnwqwQziRAtZkiFJVx9F64GLAtoIlCQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<section class="section">
    <div class="container">
        <a href="/tourguide/bookings"><span><i class="fas fa-arrow-left">&ensp;</i> Back to All Bookings</span></a>
        <h1 class="is-size-2 has-text-weight-bold">{{ data.book.[Shop.tourTitle]}}</h1>
        <div class="columns">
            <div class="column is-three-quarters">
                <!-- START: Tabs  -->
                    <div class="tabs is-left pt-4">
                    <ul>
                        <li class="tab pl-3 pr-3 is-active" onclick="openTab(event,'Activity')">
                            <a>Activity</a>
                        </li>
                        {{#ifEquals data.book.custom 1}}
                        <li class="tab pl-3 pr-3" onclick="openTab(event,'Customize')">
                            <a>Customize</a>
                        </li>
                        {{/ifEquals}}
                        <li class="tab pl-3 pr-3" onclick="openTab(event,'Details')">
                            <a>Tour Details</a>
                        </li>
                        <li class="tab pl-3 pr-3" onclick="openTab(event,'Payment')">
                            <a>Payment</a>
                        </li>
                        {{#ifEquals data.book.custom 1}}
                        <li class="tab pl-3 pr-3" onclick="openTab(event,'Req')">
                            <a>Requirements &amp; Requests</a>
                        </li>
                        {{/ifEquals}}
                    </ul>
                    </div>
                <!--END: Tabs-->

                <!--START: Activity Section-->
                <div id="Activity" class="content-tab">
                    <div class="box">
                    <section class="section">
                        <div class="container">
                            <p class="has-text-centered is-size-4 has-text-weight-bold">Activity</p>
                            <div class="has-text-weight-semibold">
                            <span>Current Progress</span>
                            <progress class="progress is-success" value={{data.book.processStep}} max="6">100%</progress>
                            <div id="steps">
                            <p>Current Step</p>
                            <!--START: steps-->
                            <div class="tags are-medium">
                                {{#ifEquals data.book.processStep '1'}}
                                    <a href="#"><span class="tag is-link">Submit Tour Plan &nbsp;</span></a>
                                {{/ifEquals}}
                                {{#ifEquals data.book.processStep '6'}}
                                <a href="#"><span class="tag is-link">Leave a Review &nbsp;<i class="fas fa-arrow-right"></i></span></a>
                                {{/ifEquals}}
                                {{#ifInRange data.book.processStep 2 4}}
                                <span class="tag">Awaiting Customer Action</span>
                                {{/ifInRange}}
                            </div>
                            </div>
                            <!--END: steps-->
                            </div>
                            <br>
                            <div class="divider is-right"></div>
                            <p class="has-text-right has-text-link"><i class="fas fa-angle-double-down"></i> 
                            Jump to latest activity</p>
                               <!--START: timeline-->

                            <div class="timeline">
                                <header class="timeline-header">
                                    <span class="tag is-primary">Start</span>
                                </header>

                                <span id="timeline-container">

                                {{#each data.timeline}}
                                    {{#ifEquals this.flag 'ACTIVITY'}}
                                        <div class="timeline-item">
                                            <div class="timeline-marker is-icon has-background-success has-text-white">
                                                <i class="fas fa-check"></i>
                                            </div>
                                            <div class="timeline-content">
                                                <p class="has-text-weight-semibold">{{this.messageText}}</p>
                                            </div>
                                        </div>
                                    {{/ifEquals}}

                                    {{#ifEquals this.flag 'SENT'}}
                                        <div class="timeline-item">
                                            <div class="timeline-marker is-icon has-background-success has-text-white">
                                                <i class="fas fa-comment"></i>
                                            </div>
                                            <div class="timeline-content">
                                                {{#ifEquals this.senderId @root.data.currentUser.id}}
                                                <p class="has-text-weight-semibold">You sent a message:</p>
                                                {{else}}
                                                <p class="has-text-weight-semibold">{{this.senderId}} sent a message:</p>
                                                {{/ifEquals}}
                                                <p>{{this.messageText}}</p>
                                            </div>
                                        </div>
                                    {{/ifEquals}}

                                    {{#ifEquals this.flag 'TOURPLAN'}}
                                        <div class="timeline-item">
                                    <div class="timeline-marker is-icon has-background-success has-text-white">
                                    <i class="fas fa-check"></i>
                                    </div>
                                    <div class="timeline-content">
                                    <p class="has-text-weight-semibold">You
                                        posted a draft of the Tour Plan (#{{this.messageText}}).</p>

                                    <!--Tour plan card-->
                                    <div class="card ml-3 mt-3 has-background-white-ter is-shadowless">

                                        <header class="card-header is-clickable" onclick="collapseCard(this)">
                                                <p class="card-header-title has-text-centered has-text-weight-bold is-size-5">
                                                Tour Plan (#{{this.messageText}}) </p>

                                                <span class=" card-header-icon icon is-large">
                                                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                                                </span>
                                            </header>

                                        <div class="card-content is-hidden">
                                            <div class="content">
                                            <table class="table has-background-white-ter is-fullwidth">
                                                <tr>
                                                    <th><i class="far fa-calendar"></i>&ensp;Date</th>
                                                    <td>{{#with (lookup ../tourPlans (numToIndex this.messageText))}}{{dateParseISO tourStart}}{{/with}}</td>
                                                    {{!-- <td>{{#with (lookup ../tourPlans 0)}}{{dateParseISO tourStart}}{{/with}}</td> --}}
                                                </tr>
                                                <tr>
                                                    <th><i class="fas fa-clock"></i>&ensp;Start Time</th>
                                                    <td>{{#with (lookup ../tourPlans (numToIndex this.messageText))}}{{onlyTime tourStart}}{{/with}}</td>
                                                </tr>
                                                <tr>
                                                    <th><i class="fas fa-clock"></i>&ensp;End Time</th>
                                                    <td>{{#with (lookup ../tourPlans (numToIndex this.messageText))}}{{onlyTime tourEnd}}{{/with}}</td>
                                                </tr>
                                                <tr>
                                                    <th><i class="fas fa-user-friends"></i>&ensp;Number of Participants</th>
                                                    <td>{{#with (lookup ../tourPlans (numToIndex this.messageText))}}{{tourPax}}{{/with}}</td>
                                                </tr>
                                                <tr>
                                                    <th><i class="fas fa-dollar-sign"></i>&ensp;Proposed Cost</th>
                                                    <td>${{#with (lookup ../tourPlans (numToIndex this.messageText))}}{{tourPrice}}{{/with}}</td>
                                                </tr>
                                            </table>
                                            <p class="has-text-centered has-text-weight-bold">Tour Itinerary</p>
                                            <!--START: Itinerary-->

                                            <div class="timeline">
                                                <header class="timeline-header">
                                                    <span class="tag is-medium is-info">Tour Start</span>
                                                </header>

                                                {{#with (lookup ../tourPlans (numToIndex this.messageText))}}
                                                {{#each (readArrWithReplace tourItinerary)}}
                                                <div class="timeline-item">
                                                    <div class="timeline-marker is-icon">
                                                        <i class="fa fa-flag"></i>
                                                    </div>
                                                    <div class="timeline-content">
                                                        <p>{{this}}</p>
                                                    </div>
                                                </div>
                                                {{/each}}
                                                {{/with}}

                                                <div class="timeline-header">
                                                <span class="tag is-medium is-info">End</span>
                                                </div>
                                            </div>                

                                            <!--END: Itinerary-->

                                            </div>
                                        </div>

                                        {{#with (lookup ../tourPlans (numToIndex this.messageText))}}
                                        <footer class="card-footer p-4">
                                            <div class="field is-grouped mt-2">
                                            <div class="control">
                                                <button class="button 
                                                {{#ifEquals accepted '-1'}}
                                                is-danger is-outlined
                                                {{/ifEquals}}
                                                {{#ifEquals accepted '0'}}
                                                is-danger
                                                {{/ifEquals}}
                                                {{#ifEquals accepted '1'}}
                                                is-static
                                                {{/ifEquals}}
                                                " 
                                                {{#ifEquals accepted '-1'}}
                                                style="pointer-events: none;"
                                                {{/ifEquals}}
                                                {{#ifEquals accepted '1'}}
                                                style="pointer-events: none;"
                                                {{/ifEquals}}>Request a Revision

                                                {{#ifEquals accepted '-1'}}
                                                    <i class="fas fa-check ml-1"></i>
                                                {{/ifEquals}}
                                                </button>
                                            </div>

                                            <div class="control">
                                                <button class="button
                                                {{#ifEquals accepted '-1'}}
                                                is-static
                                                {{/ifEquals}}
                                                {{#ifEquals accepted '0'}}
                                                is-success
                                                {{/ifEquals}}
                                                {{#ifEquals accepted '1'}}
                                                is-success is-outlined
                                                {{/ifEquals}}
                                                "
                                                
                                                {{#ifEquals accepted '-1'}}
                                                style="pointer-events: none;"
                                                {{/ifEquals}}
                                                {{#ifEquals accepted '1'}}
                                                style="pointer-events: none;"
                                                {{/ifEquals}}>Approve Plan

                                                {{#ifEquals accepted '1'}}
                                                    <i class="fas fa-check ml-1"></i>
                                                {{/ifEquals}}
                                                </button>
                                            </div>
                                        </div>
                                        </footer>
                                        {{/with}}

                                    </div>
                                    <!--Tour plan card-->
                                    </div>
                                </div>
                                    {{/ifEquals}}


                                {{/each}}

                                {{#ifEquals data.book.processStep '1'}}
                                <div class="timeline-item">
                                    <div class="timeline-marker is-icon has-background-grey has-text-white">
                                    <i class="fas fa-ellipsis-h"></i>
                                    </div>
                                    <div class="timeline-content pt-3">
                                    <p class="button is-link is-inverted has-text-weight-semibold is-italic">
                                        <i class="fas fa-chevron-right mr-2"></i> Submit Tour Plan.</p>
                                    </div>
                                </div>
                                {{/ifEquals}}

                                {{#ifEquals data.book.processStep '6'}}
                                <div class="timeline-item">
                                    <div class="timeline-marker is-icon has-background-grey has-text-white">
                                    <i class="fas fa-ellipsis-h"></i>
                                    </div>
                                    <div class="timeline-content pt-3">
                                    <p class="button is-link is-inverted has-text-weight-semibold is-italic">
                                        <i class="fas fa-chevron-right mr-2"></i> Leave a Review.</p>
                                    </div>
                                </div>
                                {{/ifEquals}}
                                </span>

                                <header class="timeline-header">
                                    <span class="tag is-primary">End</span>
                                </header>

                                </div>
                               <!--END: timeline-->
                               {{#ifEquals data.book.completed 1}}
                               <p class="has-text-centered has-text-primary">Your booking is complete.</p>
                               {{/ifEquals}}

                                                           <hr>
                            {{!-- Textarea --}}
                            <textarea class="textarea" name="message" id="messageToSendInput" placeholder="Leave a message..." rows="5"
                                cols="50"></textarea>
                            
                            <div class="has-text-right">
                                <a id="sendMessageBtn" class="button is-light mt-4">
                                    <span class="icon is-small is-pulled-right">
                                        <i class="fas fa-paper-plane"></i>
                                    </span>
                                    <span>Send Message</span>
                                </a>
                            </div>
                            
                            <br>

                               <p class="has-text-centered has-text-link" onclick="window.scrollTo(0,0);" style="cursor: pointer;">

                               <p class="has-text-centered has-text-link" onclick="window.scrollTo(0,0);" style="cursor: pointer;">
                                <i class="fas fa-angle-double-up"></i> Back to Top</p>
                        </div>
                    </section>
                    </div>
                </div>
                <!--END: Activity Section-->

                {{#ifEquals data.book.custom 1}}
                <!--START: Customize Section-->
                <div id="Customize" class="content-tab" style="display:none;">
                    <div class="box">
                        <section class="section">
                            <div class="container">
                                <p class="has-text-centered is-size-4 has-text-weight-bold">Customize Tour Plan</p>
                                <br>
                                <!--form-->
                                <div class="divider"><p class="has-text-weight-semibold">General</p></div>
                                <form id='' class="form-horizontal" enctype="multipart/form-data" method="POST">
                <fieldset>

                    <div class='field'>
                    <label class="label" for="tour-date">Tour Date</label>
                    <div class='control'>
                        <input class="input" type="date" placeholder="Date">
                    </div>
                    </div>

                    <div class='field is-horizontal mb-5'>
                        <div class='field-body'>
                            <div class='field'>
                    <label class="label" for="tour-starttime">Start Time</label>
                    <div class='control'>
                        <input class="input" type="time" placeholder="Start Time">
                    </div>
                </div>

                    <div class='field'>
                        <label class="label" for="tour-endtime">End Time</label>
                        <div class='control'>
                            <input class="input" type="time" placeholder="End Time">
                        </div>
                        </div>  
                    </div>
                    </div>

                    <label class="label" for="tour-items">Tour itinerary</label>
                    <div class="field has-addons">
                        <div class="control is-expanded">
                            <input class="input" type="text" placeholder="Activity">
                        </div>
                        <div class="control">
                            <a id='addItemButton' class="button" onclick="AddItinerary();AppendtoItem()">
                                Add Itinerary
                            </a>
                        </div>
                    </div>
                    <br>
 
                    <div class='field'>
                        <label class="label" for="tour-price">Number of Tour Participants</label>
                        <div class='control'>
                            <input class="input" type="number" placeholder="Number of Participants">           
                        </div>
                        </div>        
                    </fieldset>
                    

                    <br>
                    <div class="divider"><p class="has-text-weight-semibold">Pricing</p></div>
                                
                    
                        <div class='field'>
                        <label class="label" for="tour-price">Base Tour Price</label>
                        <div class='control has-icons-left'>
                            <input class="input" type="number" step="0.1" placeholder="Base Tour Price">
                            <span class="icon is-small is-left">
                                <i class="fas fa-dollar-sign"></i></span>
                        </div>
                        </div>  

                        <div class="field has-addons">
                            <p class="control has-icons-left">
                                <input class="input" type="number" step="0.1" placeholder="Add-On">
                                <span class="icon is-small is-left">
                                <i class="fas fa-dollar-sign"></i></span>
                            </p>
                            <p class="control">
                                <a class="button">
                                <i class="fas fa-plus"></i>
                                </a>
                            </p>
                            </div>
                        

                        <br>
                        <div class="divider"><p class="has-text-weight-semibold">Others</p></div>
                                <div class='field'>
                        <label class="label" for="tour-price">Additional Information</label>
                        <div class='control'>
                            <textarea class="textarea" placeholder="e.g. Meet at.."></textarea>          
                        </div>
                        </div> 
                                </form>
                                <!--form-->
                            </div>
                        </section>
                    </div>
                </div>
                <!--END: Custom Section-->
                {{/ifEquals}}

                <!--START: Details Section-->
                <div id="Details" class="content-tab" style="display:none;">
                    <div class="box">
                        <section class="section">
                            <div class="container">
                                <p class="has-text-centered is-size-4 has-text-weight-bold">Tour Details
                                {{#ifInRange data.book.processStep 1 2}}
                                    <span class="tag is-warning is-light">Planning</span></p>
                                {{/ifInRange}}
                                {{#ifInRange data.book.processStep 3 6}}
                                    <span class="tag is-success is-light">Finalised</span></p>
                                {{/ifInRange}}
                                <br>
                                <!--START: Tour plan-->
                                <table class="table is-fullwidth">
                                                <tr>
                                                    <th><i class="far fa-calendar"></i>&ensp;Date</th>
                                                    <td>{{dateParseISO data.book.tourStart}}</td>
                                                </tr>
                                                <tr>
                                                    <th><i class="fas fa-clock"></i>&ensp;Start Time</th>
                                                    {{#ifInRange data.book.processStep 0 2}}
                                                    <td>Unconfirmed</td>
                                                    {{/ifInRange}}
                                                    {{#ifInRange data.book.processStep 3 6}}
                                                    <td>{{onlyTime data.book.tourStart}}</td>
                                                    {{/ifInRange}}
                                                </tr>
                                                <tr>
                                                    <th><i class="fas fa-clock"></i>&ensp;End Time</th>
                                                    {{#ifInRange data.book.processStep 0 2}}
                                                    <td>Unconfirmed</td>
                                                    {{/ifInRange}}
                                                    {{#ifInRange data.book.processStep 3 6}}
                                                    <td>{{onlyTime data.book.tourEnd}}</td>
                                                    {{/ifInRange}}

                                                </tr>
                                                <tr>
                                                    <th><i class="fas fa-user-friends"></i>&ensp;Number of Participants</th>
                                                    <td>{{data.book.bookPax}}</td>
                                                </tr>
                                                <tr onclick="openTab(event,'Billing')" class="is-clickable">
                                                    <th><i class="fas fa-dollar-sign"></i>&ensp;Cost</th>
                                                    {{#ifInRange data.book.processStep 0 2}}
                                                    <td>Unconfirmed</td>
                                                    {{/ifInRange}}
                                                    {{#ifInRange data.book.processStep 3 6}}
                                                    <td>${{data.book.bookBaseprice}}</td>
                                                    {{/ifInRange}}
                                                    {{!-- Calculate final price in the backend --}}
                                                </tr>
                                            </table>
                                            <br>

                                            <!--START: Itinerary-->

                                            <div class="timeline">
                                                <header class="timeline-header">
                                                    <span class="tag is-medium is-info">Tour Start</span>
                                                </header>

                                                {{!-- replace with itinerary from booking once model is updated --}}
                                                {{#each (readArrWithReplace data.book.[Shop.finalItinerary])}}
                                                <div class="timeline-item">
                                                    <div class="timeline-marker is-icon">
                                                        <i class="fa fa-flag"></i>
                                                    </div>
                                                    <div class="timeline-content">
                                                        <p>{{this}}</p>
                                                    </div>
                                                </div>
                                                {{/each}}

                                                <div class="timeline-header">
                                                <span class="tag is-medium is-info">End</span>
                                                </div>
                                            </div><br>              
                                            <!--END: Itinerary-->
                                            {{#ifNotEquals data.book.addInfo ''}}
                                            <div>
                                                <p class="has-text-weight-bold is-size-4 has-text-centered">Additional Information</p>
                                                <p>{{data.book.addInfo}}</p>
                                            </div>
                                            {{/ifNotEquals}}

                                <!--END: Tour plan-->
                            </div>
                        </section>
                    </div>
                </div>
                <!--END: Details Section-->

                <!--START: Payment Section-->
                <div id="Payment" class="content-tab" style="display:none;">
                    <div class="box">
                        <section class="section">
                            <div class="container">
                                <div class="has-text-centered">
                                <p class="has-text-weight-bold is-size-4">{{data.book.[Shop.tourTitle]}}</p>
                                <p class="is-size-6">Overall Cost Breakdown</p>
                                {{#ifEquals data.book.paid 1}}
                                <span class="tag is-success is-light is-medium"><i class="fas fa-check mr-1"></i>Received in Full</span>
                                {{/ifEquals}}
                                </div>
                                <br>
                                <table class="table is-fullwidth">
                                    <tr class="has-background-grey-lighter">
                                        <th>Item</th>
                                        <th>Price</th>
                                    </tr>
                                    {{#ifEquals data.book.custom 1}}
                                    <tr>
                                        <td>Customisation Fee</td>
                                        <td>${{data.book.bookCharges}}</td>
                                    </tr>
                                    {{/ifEquals}}
                                    <tr>
                                        <td>Base Tour Price</td>
                                        <td>${{data.book.bookBaseprice}}</td>
                                    </tr>
                                    {{#ifEquals data.book.custom 1}}
                                    {{#ifSmaller (toNum data.book.revisions) 0}}
                                    <tr>
                                        <td>Extra Revisions {{data.book.revisions}}</td>
                                        <td>${{math data.book.revisions '*' data.book.bookCharges}}</td>
                                    </tr>
                                    {{/ifSmaller}}
                                    {{/ifEquals}}
                                    <tr>
                                        <th>Subtotal</th>
                                        {{!-- calculate subtotal server side --}}
                                        <th>${{math data.book.bookBaseprice '+' data.book.bookCharges}}</th>
                                    </tr>
                                     <tr>
                                        <th>Service Fee <span><i class="far fa-question-circle has-tooltip-multiline" 
                                        data-tooltip="Tourisit takes a 10% service fee for sustainability. Thank you for using our service."></i></span></th>
                                        <th>${{math (math data.book.bookBaseprice '+' data.book.bookCharges) '*' 0.1}}</th>
                                    </tr>
                                    <tr class="has-background-white-ter has-text-weight-bold is-size-5">
                                        <th>Total</th>
                                        <th>${{math (math (math data.book.bookBaseprice '+' data.book.bookCharges) '*' 0.1) '+' (math data.book.bookBaseprice '+' data.book.bookCharges)}}</th>
                                    </tr>
                                </table>
                            </div>
                        </section>
                    </div>
                </div>
                <!--END: Payment Section-->

                {{#ifEquals data.book.custom 1}}
                <!--START: Req Section-->
                <div id="Req" class="content-tab" style="display:none;">
                    <div class="box">
                        <section class="section">
                            <div class="container">
                                <p class="has-text-centered is-size-4 has-text-weight-bold">Requirements &amp; Requests</p>

                               {{#each (splitArr_semicolon data.book.custRequests)}}

                                    <!--Req card-->
                                    <div class="card ml-3 mt-3 has-background-white-ter is-shadowless">

                                        <header class="card-header is-clickable" onclick="collapseCard(this)">
                                                <p class="card-header-title has-text-centered has-text-weight-bold is-size-5">
                                                Request (#{{math @index '+' 1}})</p>
                                                <span class=" card-header-icon icon is-large">
                                                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                                                </span>
                                            </header>

                                        <div class="card-content is-hidden">
                                            <div class="content">
                                                <p>{{this}}</p>
                                            </div>
                                        </div>
                                        
                                    </div>
                                    <!--Req card-->

                                    {{/each}}

                            </div>
                        </section>
                    </div>
                </div>
                <!--END: Req Section-->
                {{/ifEquals}}

            </div>
            <div class="column is-one-quarter">
                <div class="container mt-5">
                    <a href="/u/messages">
                    <button class="button is-fullwidth has-text-weight-semibold is-rounded is-warning is-light">
                        <span class="icon"><i class="fas fa-comment-alt"></i></span>
                        Chat with <span class="has-text-primary ml-1 has-text-weight-bold">Customer</span>
                    </button></a>
                    <br>

                    <div class="mt-4 has-background-white-bis p-4">
                        <p class="has-text-weight-bold is-size-5 mb-2 has-text-centered">Tour Name</p>
                        <img style="border-radius:10px;" src="/static/listings/{{data.book.[Shop.tourImage]}}">
                        <p>{{data.book.[Shop.tourDesc]}}</p>
                        <a class="pt-5 is-size-7" href="/listing/info/{{data.book.[Shop.id]}}">View Original Listing</a>
                    </div>
                    <br>

                    <div class="mt-4 has-background-white-bis p-4">
                        <p class="has-text-weight-bold is-size-5 mb-2 has-text-centered">Booking Details</p>
                        <table class="table is-fullwidth has-background-white-bis">
                            <tr>
                                <th>Booking ID</th>
                                <td>{{data.book.bookId}}</td>
                            </tr>
                            <tr>
                                <th>Ordered by</th>
                                <td class="has-text-link">Customer</td>
                            </tr>
                        </table>
                    </div>
                    <br>

                    <div class="mt-4 p-4 has-background-info-light is-light">
                        <span class="has-text-weight-semibold">Have an issue with your booking?</span><br>
                        Contact <a href="/helpdesk">Support</a>.
                    </div>

                </div>
            </div>
        </div>
    </div>
</section>

<script defer src="/js/tabs.js"></script>

<input id="currentUserID" type="hidden" value="{{data.currentUser.id}}">
<input id="currentChatID" type="hidden" value="{{data.book.chatId}}">
{{!-- This exists because turbolinks caches <head></head> and is here for turbolinks to know to only run chat.js when it sees this --}}
<div id="thisIsABookingPageSoPleaseLoadTheChatScript"></div>